/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectorRef, Component, ElementRef, EventEmitter, HostListener, Input, Output, QueryList, ViewChild, ViewChildren } from '@angular/core';
import { ImageService } from '../services/image.service';
import { HttpClient } from '@angular/common/http';
var GalleryComponent = /** @class */ (function () {
    function GalleryComponent(imageService, http, changeDetectorRef) {
        this.imageService = imageService;
        this.http = http;
        this.changeDetectorRef = changeDetectorRef;
        this.gallery = [];
        this.imageDataStaticPath = 'assets/img/gallery/';
        this.imageDataCompletePath = '';
        this.dataFileName = 'data.json';
        this.images = [];
        this.minimalQualityCategory = 'preview_xxs';
        this.rowIndex = 0;
        this.rightArrowInactive = false;
        this.leftArrowInactive = false;
        this.providedImageMargin = 3;
        this.providedImageSize = 7;
        this.providedGalleryName = '';
        this.providedMetadataUri = undefined;
        this.rowsPerPage = 200;
        this.viewerChange = new EventEmitter();
    }
    /**
     * @param {?} event
     * @return {?}
     */
    GalleryComponent.prototype.triggerCycle = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this.scaleGallery();
    };
    /**
     * @param {?} event
     * @return {?}
     */
    GalleryComponent.prototype.windowResize = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this.render();
    };
    /**
     * @return {?}
     */
    GalleryComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.fetchDataAndRender();
        this.viewerSubscription = this.imageService.showImageViewerChanged$
            .subscribe(function (visibility) { return _this.viewerChange.emit(visibility); });
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    GalleryComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        // input params changed
        if (changes['providedGalleryName'] != undefined) {
            this.fetchDataAndRender();
        }
        else {
            this.render();
        }
    };
    /**
     * @return {?}
     */
    GalleryComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        if (this.viewerSubscription) {
            this.viewerSubscription.unsubscribe();
        }
    };
    /**
     * @param {?} img
     * @return {?}
     */
    GalleryComponent.prototype.openImageViewer = /**
     * @param {?} img
     * @return {?}
     */
    function (img) {
        this.imageService.updateImages(this.images);
        this.imageService.updateSelectedImageIndex(this.images.indexOf(img));
        this.imageService.showImageViewer(true);
    };
    /**
     * direction (-1: left, 1: right)
     */
    /**
     * direction (-1: left, 1: right)
     * @param {?} direction
     * @return {?}
     */
    GalleryComponent.prototype.navigate = /**
     * direction (-1: left, 1: right)
     * @param {?} direction
     * @return {?}
     */
    function (direction) {
        if ((direction === 1 && this.rowIndex < this.gallery.length - this.rowsPerPage)
            || (direction === -1 && this.rowIndex > 0)) {
            this.rowIndex += (this.rowsPerPage * direction);
        }
        this.refreshNavigationErrorState();
    };
    /**
     * @return {?}
     */
    GalleryComponent.prototype.calcImageMargin = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var galleryWidth = this.getGalleryWidth();
        /** @type {?} */
        var ratio = galleryWidth / 1920;
        return Math.round(Math.max(1, this.providedImageMargin * ratio));
    };
    /**
     * @private
     * @return {?}
     */
    GalleryComponent.prototype.fetchDataAndRender = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.imageDataCompletePath = this.providedMetadataUri;
        if (!this.providedMetadataUri) {
            this.imageDataCompletePath = this.providedGalleryName !== '' ?
                this.imageDataStaticPath + this.providedGalleryName + "/" + this.dataFileName :
                this.imageDataStaticPath + this.dataFileName;
        }
        this.http.get(this.imageDataCompletePath)
            .subscribe(function (data) {
            _this.images = data;
            _this.imageService.updateImages(_this.images);
            _this.images.forEach(function (image) {
                image['galleryImageLoaded'] = false;
                image['viewerImageLoaded'] = false;
                image['srcAfterFocus'] = '';
            });
            // twice, single leads to different strange browser behaviour
            _this.render();
            _this.render();
        }, function (err) {
            if (_this.providedMetadataUri) {
                console.error("Provided endpoint '" + _this.providedMetadataUri + "' did not serve metadata correctly or in the expected format.\n      See here for more information: https://github.com/BenjaminBrandmeier/angular2-image-gallery/blob/master/docs/externalDataSource.md,\n      Original error: " + err);
            }
            else {
                console.error("Did you run the convert script from angular2-image-gallery for your images first? Original error: " + err);
            }
        }, function () { return undefined; });
    };
    /**
     * @private
     * @return {?}
     */
    GalleryComponent.prototype.render = /**
     * @private
     * @return {?}
     */
    function () {
        this.gallery = [];
        /** @type {?} */
        var tempRow = [this.images[0]];
        /** @type {?} */
        var currentRowIndex = 0;
        /** @type {?} */
        var i = 0;
        for (i; i < this.images.length; i++) {
            while (this.images[i + 1] && this.shouldAddCandidate(tempRow, this.images[i + 1])) {
                i++;
            }
            if (this.images[i + 1]) {
                tempRow.pop();
            }
            this.gallery[currentRowIndex++] = tempRow;
            tempRow = [this.images[i + 1]];
        }
        this.scaleGallery();
    };
    /**
     * @private
     * @param {?} imgRow
     * @param {?} candidate
     * @return {?}
     */
    GalleryComponent.prototype.shouldAddCandidate = /**
     * @private
     * @param {?} imgRow
     * @param {?} candidate
     * @return {?}
     */
    function (imgRow, candidate) {
        /** @type {?} */
        var oldDifference = this.calcIdealHeight() - this.calcRowHeight(imgRow);
        imgRow.push(candidate);
        /** @type {?} */
        var newDifference = this.calcIdealHeight() - this.calcRowHeight(imgRow);
        return Math.abs(oldDifference) > Math.abs(newDifference);
    };
    /**
     * @private
     * @param {?} imgRow
     * @return {?}
     */
    GalleryComponent.prototype.calcRowHeight = /**
     * @private
     * @param {?} imgRow
     * @return {?}
     */
    function (imgRow) {
        /** @type {?} */
        var originalRowWidth = this.calcOriginalRowWidth(imgRow);
        /** @type {?} */
        var ratio = (this.getGalleryWidth() - (imgRow.length - 1) * this.calcImageMargin()) / originalRowWidth;
        /** @type {?} */
        var rowHeight = imgRow[0][this.minimalQualityCategory]['height'] * ratio;
        return rowHeight;
    };
    /**
     * @private
     * @param {?} imgRow
     * @return {?}
     */
    GalleryComponent.prototype.calcOriginalRowWidth = /**
     * @private
     * @param {?} imgRow
     * @return {?}
     */
    function (imgRow) {
        var _this = this;
        /** @type {?} */
        var originalRowWidth = 0;
        imgRow.forEach(function (img) {
            /** @type {?} */
            var individualRatio = _this.calcIdealHeight() / img[_this.minimalQualityCategory]['height'];
            img[_this.minimalQualityCategory]['width'] = img[_this.minimalQualityCategory]['width'] * individualRatio;
            img[_this.minimalQualityCategory]['height'] = _this.calcIdealHeight();
            originalRowWidth += img[_this.minimalQualityCategory]['width'];
        });
        return originalRowWidth;
    };
    /**
     * @private
     * @return {?}
     */
    GalleryComponent.prototype.calcIdealHeight = /**
     * @private
     * @return {?}
     */
    function () {
        return this.getGalleryWidth() / (80 / this.providedImageSize) + 100;
    };
    /**
     * @private
     * @return {?}
     */
    GalleryComponent.prototype.getGalleryWidth = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.galleryContainer.nativeElement.clientWidth === 0) {
            // for IE11
            return this.galleryContainer.nativeElement.scrollWidth;
        }
        return this.galleryContainer.nativeElement.clientWidth;
    };
    /**
     * @private
     * @return {?}
     */
    GalleryComponent.prototype.scaleGallery = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var imageCounter = 0;
        /** @type {?} */
        var maximumGalleryImageHeight = 0;
        this.gallery.slice(this.rowIndex, this.rowIndex + this.rowsPerPage)
            .forEach(function (imgRow) {
            /** @type {?} */
            var originalRowWidth = _this.calcOriginalRowWidth(imgRow);
            if (imgRow !== _this.gallery[_this.gallery.length - 1]) {
                /** @type {?} */
                var ratio_1 = (_this.getGalleryWidth() - (imgRow.length - 1) * _this.calcImageMargin()) / originalRowWidth;
                imgRow.forEach(function (img) {
                    img['width'] = img[_this.minimalQualityCategory]['width'] * ratio_1;
                    img['height'] = img[_this.minimalQualityCategory]['height'] * ratio_1;
                    maximumGalleryImageHeight = Math.max(maximumGalleryImageHeight, img['height']);
                    _this.checkForAsyncLoading(img, imageCounter++);
                });
            }
            else {
                imgRow.forEach(function (img) {
                    img.width = img[_this.minimalQualityCategory]['width'];
                    img.height = img[_this.minimalQualityCategory]['height'];
                    maximumGalleryImageHeight = Math.max(maximumGalleryImageHeight, img['height']);
                    _this.checkForAsyncLoading(img, imageCounter++);
                });
            }
        });
        this.minimalQualityCategory = maximumGalleryImageHeight > 375 ? 'preview_xs' : 'preview_xxs';
        this.refreshNavigationErrorState();
        this.changeDetectorRef.detectChanges();
    };
    /**
     * @private
     * @param {?} image
     * @param {?} imageCounter
     * @return {?}
     */
    GalleryComponent.prototype.checkForAsyncLoading = /**
     * @private
     * @param {?} image
     * @param {?} imageCounter
     * @return {?}
     */
    function (image, imageCounter) {
        /** @type {?} */
        var imageElements = this.imageElements.toArray();
        if (image['galleryImageLoaded'] ||
            (imageElements.length > 0 &&
                imageElements[imageCounter] &&
                this.isScrolledIntoView(imageElements[imageCounter].nativeElement))) {
            image['galleryImageLoaded'] = true;
            image['srcAfterFocus'] = image[this.minimalQualityCategory]['path'];
        }
        else {
            image['srcAfterFocus'] = '';
        }
    };
    /**
     * @private
     * @param {?} element
     * @return {?}
     */
    GalleryComponent.prototype.isScrolledIntoView = /**
     * @private
     * @param {?} element
     * @return {?}
     */
    function (element) {
        /** @type {?} */
        var elementTop = element.getBoundingClientRect().top;
        /** @type {?} */
        var elementBottom = element.getBoundingClientRect().bottom;
        return elementTop < window.innerHeight && elementBottom >= 0 && (elementBottom > 0 || elementTop > 0);
    };
    /**
     * @private
     * @return {?}
     */
    GalleryComponent.prototype.refreshNavigationErrorState = /**
     * @private
     * @return {?}
     */
    function () {
        this.leftArrowInactive = this.rowIndex == 0;
        this.rightArrowInactive = this.rowIndex > (this.gallery.length - this.rowsPerPage);
    };
    GalleryComponent.decorators = [
        { type: Component, args: [{
                    selector: 'gallery',
                    template: "<div #galleryContainer class=\"galleryContainer\">\n    <div class=\"innerGalleryContainer\">\n        <div *ngFor='let imgrow of gallery | slice:rowIndex:rowIndex+rowsPerPage; let i = index'\n             class=\"imagerow\"\n             [style.margin-bottom.px]=\"calcImageMargin()\">\n            <img #imageElement\n                 *ngFor='let img of imgrow; let j = index'\n                 class=\"thumbnail\"\n                 [style.width.px]=\"img['width']\"\n                 [style.height.px]=\"img['height']\"\n                 (click)=\"openImageViewer(img)\"\n                 [src]=\"img['srcAfterFocus']\"\n                 [style.background]=\"img.dominantColor\"\n                 [style.margin-right.px]=\"calcImageMargin()\"/>\n        </div>\n    </div>\n\n    <div class=\"pagerContainer\" *ngIf=\"(!rightArrowInactive || !leftArrowInactive)\">\n        <img [ngClass]=\"{'inactive': leftArrowInactive}\" class=\"pager left\"\n             src=\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjxzdmcgaWQ9IkxheWVyXzEiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDQ4IDQ4OyIgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgNDggNDgiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxnPjxwYXRoIGQ9Ik0yNCw0NkMxMS45LDQ2LDIsMzYuMSwyLDI0UzExLjksMiwyNCwyczIyLDkuOSwyMiwyMlMzNi4xLDQ2LDI0LDQ2eiBNMjQsNEMxMyw0LDQsMTMsNCwyNGMwLDExLDksMjAsMjAsMjAgICBjMTEsMCwyMC05LDIwLTIwQzQ0LDEzLDM1LDQsMjQsNHoiLz48L2c+PGc+PHBvbHlnb24gcG9pbnRzPSIyNy42LDM2LjcgMTQuOSwyNCAyNy42LDExLjMgMjkuMSwxMi43IDE3LjgsMjQgMjkuMSwzNS4zICAiLz48L2c+PC9zdmc+\"\n             (click)=\"navigate(-1)\"/>\n        <img [ngClass]=\"{'inactive': rightArrowInactive}\" class=\"pager right\"\n             src=\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjxzdmcgaWQ9IkxheWVyXzEiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDQ4IDQ4OyIgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgNDggNDgiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxnPjxwYXRoIGQ9Ik0yNCw0NkMxMS45LDQ2LDIsMzYuMSwyLDI0UzExLjksMiwyNCwyczIyLDkuOSwyMiwyMlMzNi4xLDQ2LDI0LDQ2eiBNMjQsNEMxMyw0LDQsMTMsNCwyNHM5LDIwLDIwLDIwczIwLTksMjAtMjAgICBTMzUsNCwyNCw0eiIvPjwvZz48Zz48cG9seWdvbiBwb2ludHM9IjIxLjQsMzYuNyAxOS45LDM1LjMgMzEuMiwyNCAxOS45LDEyLjcgMjEuNCwxMS4zIDM0LjEsMjQgICIvPjwvZz48L3N2Zz4=\"\n             (click)=\"navigate(1)\"/>\n    </div>\n</div>\n\n<viewer></viewer>\n",
                    styles: [".innerGalleryContainer{position:relative}.galleryContainer{height:100%;width:100%;overflow:hidden}.innerGalleryContainer img:last-child{margin-right:-1px!important}.galleryContainer img:hover{-webkit-filter:brightness(50%);filter:brightness(50%);transition:all ease-out .2s;cursor:pointer}.imagerow{margin-right:1px;overflow:hidden;display:flex}::-webkit-scrollbar{display:none}.asyncLoadingContainer{position:absolute;background-color:transparent;height:0;width:0;bottom:120px}.pagerContainer{margin:40px auto;width:180px}.pager{display:block;height:60px}@media (max-width:700px){.pagerContainer{margin:40px auto;width:150px}.pager{display:block;height:45px}}.pager.inactive{opacity:.15}.pager.left{float:left}.pager.right{float:right}"]
                },] },
    ];
    /** @nocollapse */
    GalleryComponent.ctorParameters = function () { return [
        { type: ImageService },
        { type: HttpClient },
        { type: ChangeDetectorRef }
    ]; };
    GalleryComponent.propDecorators = {
        providedImageMargin: [{ type: Input, args: ['flexBorderSize',] }],
        providedImageSize: [{ type: Input, args: ['flexImageSize',] }],
        providedGalleryName: [{ type: Input, args: ['galleryName',] }],
        providedMetadataUri: [{ type: Input, args: ['metadataUri',] }],
        rowsPerPage: [{ type: Input, args: ['maxRowsPerPage',] }],
        viewerChange: [{ type: Output }],
        galleryContainer: [{ type: ViewChild, args: ['galleryContainer',] }],
        imageElements: [{ type: ViewChildren, args: ['imageElement',] }],
        triggerCycle: [{ type: HostListener, args: ['window:scroll', ['$event'],] }],
        windowResize: [{ type: HostListener, args: ['window:resize', ['$event'],] }]
    };
    return GalleryComponent;
}());
export { GalleryComponent };
if (false) {
    /** @type {?} */
    GalleryComponent.prototype.gallery;
    /** @type {?} */
    GalleryComponent.prototype.imageDataStaticPath;
    /** @type {?} */
    GalleryComponent.prototype.imageDataCompletePath;
    /** @type {?} */
    GalleryComponent.prototype.dataFileName;
    /** @type {?} */
    GalleryComponent.prototype.images;
    /** @type {?} */
    GalleryComponent.prototype.minimalQualityCategory;
    /** @type {?} */
    GalleryComponent.prototype.viewerSubscription;
    /** @type {?} */
    GalleryComponent.prototype.rowIndex;
    /** @type {?} */
    GalleryComponent.prototype.rightArrowInactive;
    /** @type {?} */
    GalleryComponent.prototype.leftArrowInactive;
    /** @type {?} */
    GalleryComponent.prototype.providedImageMargin;
    /** @type {?} */
    GalleryComponent.prototype.providedImageSize;
    /** @type {?} */
    GalleryComponent.prototype.providedGalleryName;
    /** @type {?} */
    GalleryComponent.prototype.providedMetadataUri;
    /** @type {?} */
    GalleryComponent.prototype.rowsPerPage;
    /** @type {?} */
    GalleryComponent.prototype.viewerChange;
    /** @type {?} */
    GalleryComponent.prototype.galleryContainer;
    /** @type {?} */
    GalleryComponent.prototype.imageElements;
    /** @type {?} */
    GalleryComponent.prototype.imageService;
    /** @type {?} */
    GalleryComponent.prototype.http;
    /** @type {?} */
    GalleryComponent.prototype.changeDetectorRef;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2FsbGVyeS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9hbmd1bGFyMi1pbWFnZS1nYWxsZXJ5LyIsInNvdXJjZXMiOlsibGliL2dhbGxlcnkvZ2FsbGVyeS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFDTCxpQkFBaUIsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLFlBQVksRUFBRSxZQUFZLEVBQ3BFLEtBQUssRUFBZ0MsTUFBTSxFQUFFLFNBQVMsRUFBaUIsU0FBUyxFQUFFLFlBQVksRUFDL0YsTUFBTSxlQUFlLENBQUE7QUFDdEIsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDJCQUEyQixDQUFBO0FBRXhELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQTtBQUVqRDtJQWdFSSwwQkFBbUIsWUFBMEIsRUFBUyxJQUFnQixFQUFTLGlCQUFvQztRQUFoRyxpQkFBWSxHQUFaLFlBQVksQ0FBYztRQUFTLFNBQUksR0FBSixJQUFJLENBQVk7UUFBUyxzQkFBaUIsR0FBakIsaUJBQWlCLENBQW1CO1FBOUJuSCxZQUFPLEdBQWUsRUFBRSxDQUFBO1FBQ3hCLHdCQUFtQixHQUFXLHFCQUFxQixDQUFBO1FBQ25ELDBCQUFxQixHQUFXLEVBQUUsQ0FBQTtRQUNsQyxpQkFBWSxHQUFXLFdBQVcsQ0FBQTtRQUNsQyxXQUFNLEdBQWUsRUFBRSxDQUFBO1FBQ3ZCLDJCQUFzQixHQUFHLGFBQWEsQ0FBQTtRQUV0QyxhQUFRLEdBQVcsQ0FBQyxDQUFBO1FBQ3BCLHVCQUFrQixHQUFZLEtBQUssQ0FBQTtRQUNuQyxzQkFBaUIsR0FBWSxLQUFLLENBQUE7UUFFVCx3QkFBbUIsR0FBVyxDQUFDLENBQUE7UUFDaEMsc0JBQWlCLEdBQVcsQ0FBQyxDQUFBO1FBQy9CLHdCQUFtQixHQUFXLEVBQUUsQ0FBQTtRQUNoQyx3QkFBbUIsR0FBVyxTQUFTLENBQUE7UUFDcEMsZ0JBQVcsR0FBVyxHQUFHLENBQUE7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Z0JBRVosVUFBVTtnQkFMakIsaUJBQWlCOzs7c0NBb0RkLEtBQUssU0FBQyxnQkFBZ0I7b0NBQ3RCLEtBQUssU0FBQyxlQUFlO3NDQUNyQixLQUFLLFNBQUMsYUFBYTtzQ0FDbkIsS0FBSyxTQUFDLGFBQWE7OEJBQ25CLEtBQUssU0FBQyxnQkFBZ0I7K0JBRXRCLE1BQU07bUNBRU4sU0FBUyxTQUFDLGtCQUFrQjtnQ0FDNUIsWUFBWSxTQUFDLGNBQWM7K0JBRTNCLFlBQVksU0FBQyxlQUFlLEVBQUUsQ0FBQyxRQUFRLENBQUM7K0JBSXhDLFlBQVksU0FBQyxlQUFlLEVBQUUsQ0FBQyxRQUFRLENBQUM7O0lBZ043Qyx1QkFBQztDQUFBLEFBNVFELElBNFFDO1NBM09ZLGdCQUFnQjs7O0lBQ3pCLG1DQUF3Qjs7SUFDeEIsK0NBQW1EOztJQUNuRCxpREFBa0M7O0lBQ2xDLHdDQUFrQzs7SUFDbEMsa0NBQXVCOztJQUN2QixrREFBc0M7O0lBQ3RDLDhDQUFnQzs7SUFDaEMsb0NBQW9COztJQUNwQiw4Q0FBbUM7O0lBQ25DLDZDQUFrQzs7SUFFbEMsK0NBQXdEOztJQUN4RCw2Q0FBcUQ7O0lBQ3JELCtDQUFzRDs7SUFDdEQsK0NBQTZEOztJQUM3RCx1Q0FBa0Q7O0lBRWxELHdDQUFvRDs7SUFFcEQsNENBQTJEOztJQUMzRCx5Q0FBMkQ7O0lBVS9DLHdDQUFpQzs7SUFBRSxnQ0FBdUI7O0lBQUUsNkNBQTJDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsIENvbXBvbmVudCwgRWxlbWVudFJlZiwgRXZlbnRFbWl0dGVyLCBIb3N0TGlzdGVuZXIsXG4gIElucHV0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSwgT25Jbml0LCBPdXRwdXQsIFF1ZXJ5TGlzdCwgU2ltcGxlQ2hhbmdlcywgVmlld0NoaWxkLCBWaWV3Q2hpbGRyZW5cbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSdcbmltcG9ydCB7IEltYWdlU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL2ltYWdlLnNlcnZpY2UnXG5pbXBvcnQgeyBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzL2ludGVybmFsL1N1YnNjcmlwdGlvbidcbmltcG9ydCB7IEh0dHBDbGllbnQgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCdcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdnYWxsZXJ5JyxcbiAgICB0ZW1wbGF0ZTogYDxkaXYgI2dhbGxlcnlDb250YWluZXIgY2xhc3M9XCJnYWxsZXJ5Q29udGFpbmVyXCI+XG4gICAgPGRpdiBjbGFzcz1cImlubmVyR2FsbGVyeUNvbnRhaW5lclwiPlxuICAgICAgICA8ZGl2ICpuZ0Zvcj0nbGV0IGltZ3JvdyBvZiBnYWxsZXJ5IHwgc2xpY2U6cm93SW5kZXg6cm93SW5kZXgrcm93c1BlclBhZ2U7IGxldCBpID0gaW5kZXgnXG4gICAgICAgICAgICAgY2xhc3M9XCJpbWFnZXJvd1wiXG4gICAgICAgICAgICAgW3N0eWxlLm1hcmdpbi1ib3R0b20ucHhdPVwiY2FsY0ltYWdlTWFyZ2luKClcIj5cbiAgICAgICAgICAgIDxpbWcgI2ltYWdlRWxlbWVudFxuICAgICAgICAgICAgICAgICAqbmdGb3I9J2xldCBpbWcgb2YgaW1ncm93OyBsZXQgaiA9IGluZGV4J1xuICAgICAgICAgICAgICAgICBjbGFzcz1cInRodW1ibmFpbFwiXG4gICAgICAgICAgICAgICAgIFtzdHlsZS53aWR0aC5weF09XCJpbWdbJ3dpZHRoJ11cIlxuICAgICAgICAgICAgICAgICBbc3R5bGUuaGVpZ2h0LnB4XT1cImltZ1snaGVpZ2h0J11cIlxuICAgICAgICAgICAgICAgICAoY2xpY2spPVwib3BlbkltYWdlVmlld2VyKGltZylcIlxuICAgICAgICAgICAgICAgICBbc3JjXT1cImltZ1snc3JjQWZ0ZXJGb2N1cyddXCJcbiAgICAgICAgICAgICAgICAgW3N0eWxlLmJhY2tncm91bmRdPVwiaW1nLmRvbWluYW50Q29sb3JcIlxuICAgICAgICAgICAgICAgICBbc3R5bGUubWFyZ2luLXJpZ2h0LnB4XT1cImNhbGNJbWFnZU1hcmdpbigpXCIvPlxuICAgICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cblxuICAgIDxkaXYgY2xhc3M9XCJwYWdlckNvbnRhaW5lclwiICpuZ0lmPVwiKCFyaWdodEFycm93SW5hY3RpdmUgfHwgIWxlZnRBcnJvd0luYWN0aXZlKVwiPlxuICAgICAgICA8aW1nIFtuZ0NsYXNzXT1cInsnaW5hY3RpdmUnOiBsZWZ0QXJyb3dJbmFjdGl2ZX1cIiBjbGFzcz1cInBhZ2VyIGxlZnRcIlxuICAgICAgICAgICAgIHNyYz1cImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEQ5NGJXd2dkbVZ5YzJsdmJqMGlNUzR3SWlBL1BqeHpkbWNnYVdROUlreGhlV1Z5WHpFaUlITjBlV3hsUFNKbGJtRmliR1V0WW1GamEyZHliM1Z1WkRwdVpYY2dNQ0F3SURRNElEUTRPeUlnZG1WeWMybHZiajBpTVM0eElpQjJhV1YzUW05NFBTSXdJREFnTkRnZ05EZ2lJSGh0YkRwemNHRmpaVDBpY0hKbGMyVnlkbVVpSUhodGJHNXpQU0pvZEhSd09pOHZkM2QzTG5jekxtOXlaeTh5TURBd0wzTjJaeUlnZUcxc2JuTTZlR3hwYm1zOUltaDBkSEE2THk5M2QzY3Vkek11YjNKbkx6RTVPVGt2ZUd4cGJtc2lQanhuUGp4d1lYUm9JR1E5SWsweU5DdzBOa014TVM0NUxEUTJMRElzTXpZdU1Td3lMREkwVXpFeExqa3NNaXd5TkN3eWN6SXlMRGt1T1N3eU1pd3lNbE16Tmk0eExEUTJMREkwTERRMmVpQk5NalFzTkVNeE15dzBMRFFzTVRNc05Dd3lOR013TERFeExEa3NNakFzTWpBc01qQWdJQ0JqTVRFc01Dd3lNQzA1TERJd0xUSXdRelEwTERFekxETTFMRFFzTWpRc05Ib2lMejQ4TDJjK1BHYytQSEJ2YkhsbmIyNGdjRzlwYm5SelBTSXlOeTQyTERNMkxqY2dNVFF1T1N3eU5DQXlOeTQyTERFeExqTWdNamt1TVN3eE1pNDNJREUzTGpnc01qUWdNamt1TVN3ek5TNHpJQ0FpTHo0OEwyYytQQzl6ZG1jK1wiXG4gICAgICAgICAgICAgKGNsaWNrKT1cIm5hdmlnYXRlKC0xKVwiLz5cbiAgICAgICAgPGltZyBbbmdDbGFzc109XCJ7J2luYWN0aXZlJzogcmlnaHRBcnJvd0luYWN0aXZlfVwiIGNsYXNzPVwicGFnZXIgcmlnaHRcIlxuICAgICAgICAgICAgIHNyYz1cImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEQ5NGJXd2dkbVZ5YzJsdmJqMGlNUzR3SWlBL1BqeHpkbWNnYVdROUlreGhlV1Z5WHpFaUlITjBlV3hsUFNKbGJtRmliR1V0WW1GamEyZHliM1Z1WkRwdVpYY2dNQ0F3SURRNElEUTRPeUlnZG1WeWMybHZiajBpTVM0eElpQjJhV1YzUW05NFBTSXdJREFnTkRnZ05EZ2lJSGh0YkRwemNHRmpaVDBpY0hKbGMyVnlkbVVpSUhodGJHNXpQU0pvZEhSd09pOHZkM2QzTG5jekxtOXlaeTh5TURBd0wzTjJaeUlnZUcxc2JuTTZlR3hwYm1zOUltaDBkSEE2THk5M2QzY3Vkek11YjNKbkx6RTVPVGt2ZUd4cGJtc2lQanhuUGp4d1lYUm9JR1E5SWsweU5DdzBOa014TVM0NUxEUTJMRElzTXpZdU1Td3lMREkwVXpFeExqa3NNaXd5TkN3eWN6SXlMRGt1T1N3eU1pd3lNbE16Tmk0eExEUTJMREkwTERRMmVpQk5NalFzTkVNeE15dzBMRFFzTVRNc05Dd3lOSE01TERJd0xESXdMREl3Y3pJd0xUa3NNakF0TWpBZ0lDQlRNelVzTkN3eU5DdzBlaUl2UGp3dlp6NDhaejQ4Y0c5c2VXZHZiaUJ3YjJsdWRITTlJakl4TGpRc016WXVOeUF4T1M0NUxETTFMak1nTXpFdU1pd3lOQ0F4T1M0NUxERXlMamNnTWpFdU5Dd3hNUzR6SURNMExqRXNNalFnSUNJdlBqd3ZaejQ4TDNOMlp6ND1cIlxuICAgICAgICAgICAgIChjbGljayk9XCJuYXZpZ2F0ZSgxKVwiLz5cbiAgICA8L2Rpdj5cbjwvZGl2PlxuXG48dmlld2VyPjwvdmlld2VyPlxuYCxcbiAgICBzdHlsZXM6IFtgLmlubmVyR2FsbGVyeUNvbnRhaW5lcntwb3NpdGlvbjpyZWxhdGl2ZX0uZ2FsbGVyeUNvbnRhaW5lcntoZWlnaHQ6MTAwJTt3aWR0aDoxMDAlO292ZXJmbG93OmhpZGRlbn0uaW5uZXJHYWxsZXJ5Q29udGFpbmVyIGltZzpsYXN0LWNoaWxke21hcmdpbi1yaWdodDotMXB4IWltcG9ydGFudH0uZ2FsbGVyeUNvbnRhaW5lciBpbWc6aG92ZXJ7LXdlYmtpdC1maWx0ZXI6YnJpZ2h0bmVzcyg1MCUpO2ZpbHRlcjpicmlnaHRuZXNzKDUwJSk7dHJhbnNpdGlvbjphbGwgZWFzZS1vdXQgLjJzO2N1cnNvcjpwb2ludGVyfS5pbWFnZXJvd3ttYXJnaW4tcmlnaHQ6MXB4O292ZXJmbG93OmhpZGRlbjtkaXNwbGF5OmZsZXh9Ojotd2Via2l0LXNjcm9sbGJhcntkaXNwbGF5Om5vbmV9LmFzeW5jTG9hZGluZ0NvbnRhaW5lcntwb3NpdGlvbjphYnNvbHV0ZTtiYWNrZ3JvdW5kLWNvbG9yOnRyYW5zcGFyZW50O2hlaWdodDowO3dpZHRoOjA7Ym90dG9tOjEyMHB4fS5wYWdlckNvbnRhaW5lcnttYXJnaW46NDBweCBhdXRvO3dpZHRoOjE4MHB4fS5wYWdlcntkaXNwbGF5OmJsb2NrO2hlaWdodDo2MHB4fUBtZWRpYSAobWF4LXdpZHRoOjcwMHB4KXsucGFnZXJDb250YWluZXJ7bWFyZ2luOjQwcHggYXV0bzt3aWR0aDoxNTBweH0ucGFnZXJ7ZGlzcGxheTpibG9jaztoZWlnaHQ6NDVweH19LnBhZ2VyLmluYWN0aXZle29wYWNpdHk6LjE1fS5wYWdlci5sZWZ0e2Zsb2F0OmxlZnR9LnBhZ2VyLnJpZ2h0e2Zsb2F0OnJpZ2h0fWBdXG59KVxuZXhwb3J0IGNsYXNzIEdhbGxlcnlDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSwgT25DaGFuZ2VzIHtcbiAgICBnYWxsZXJ5OiBBcnJheTxhbnk+ID0gW11cbiAgICBpbWFnZURhdGFTdGF0aWNQYXRoOiBzdHJpbmcgPSAnYXNzZXRzL2ltZy9nYWxsZXJ5LydcbiAgICBpbWFnZURhdGFDb21wbGV0ZVBhdGg6IHN0cmluZyA9ICcnXG4gICAgZGF0YUZpbGVOYW1lOiBzdHJpbmcgPSAnZGF0YS5qc29uJ1xuICAgIGltYWdlczogQXJyYXk8YW55PiA9IFtdXG4gICAgbWluaW1hbFF1YWxpdHlDYXRlZ29yeSA9ICdwcmV2aWV3X3h4cydcbiAgICB2aWV3ZXJTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvblxuICAgIHJvd0luZGV4OiBudW1iZXIgPSAwXG4gICAgcmlnaHRBcnJvd0luYWN0aXZlOiBib29sZWFuID0gZmFsc2VcbiAgICBsZWZ0QXJyb3dJbmFjdGl2ZTogYm9vbGVhbiA9IGZhbHNlXG5cbiAgICBASW5wdXQoJ2ZsZXhCb3JkZXJTaXplJykgcHJvdmlkZWRJbWFnZU1hcmdpbjogbnVtYmVyID0gM1xuICAgIEBJbnB1dCgnZmxleEltYWdlU2l6ZScpIHByb3ZpZGVkSW1hZ2VTaXplOiBudW1iZXIgPSA3XG4gICAgQElucHV0KCdnYWxsZXJ5TmFtZScpIHByb3ZpZGVkR2FsbGVyeU5hbWU6IHN0cmluZyA9ICcnXG4gICAgQElucHV0KCdtZXRhZGF0YVVyaScpIHByb3ZpZGVkTWV0YWRhdGFVcmk6IHN0cmluZyA9IHVuZGVmaW5lZFxuICAgIEBJbnB1dCgnbWF4Um93c1BlclBhZ2UnKSByb3dzUGVyUGFnZTogbnVtYmVyID0gMjAwXG5cbiAgICBAT3V0cHV0KCkgdmlld2VyQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjxib29sZWFuPigpXG5cbiAgICBAVmlld0NoaWxkKCdnYWxsZXJ5Q29udGFpbmVyJykgZ2FsbGVyeUNvbnRhaW5lcjogRWxlbWVudFJlZlxuICAgIEBWaWV3Q2hpbGRyZW4oJ2ltYWdlRWxlbWVudCcpIGltYWdlRWxlbWVudHM6IFF1ZXJ5TGlzdDxhbnk+XG5cbiAgICBASG9zdExpc3RlbmVyKCd3aW5kb3c6c2Nyb2xsJywgWyckZXZlbnQnXSkgdHJpZ2dlckN5Y2xlKGV2ZW50OiBhbnkpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zY2FsZUdhbGxlcnkoKVxuICAgIH1cblxuICAgIEBIb3N0TGlzdGVuZXIoJ3dpbmRvdzpyZXNpemUnLCBbJyRldmVudCddKSB3aW5kb3dSZXNpemUoZXZlbnQ6IGFueSk6IHZvaWQge1xuICAgICAgICB0aGlzLnJlbmRlcigpXG4gICAgfVxuXG4gICAgY29uc3RydWN0b3IocHVibGljIGltYWdlU2VydmljZTogSW1hZ2VTZXJ2aWNlLCBwdWJsaWMgaHR0cDogSHR0cENsaWVudCwgcHVibGljIGNoYW5nZURldGVjdG9yUmVmOiBDaGFuZ2VEZXRlY3RvclJlZikge1xuICAgIH1cblxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xuICAgICAgICB0aGlzLmZldGNoRGF0YUFuZFJlbmRlcigpXG4gICAgICAgIHRoaXMudmlld2VyU3Vic2NyaXB0aW9uID0gdGhpcy5pbWFnZVNlcnZpY2Uuc2hvd0ltYWdlVmlld2VyQ2hhbmdlZCRcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKHZpc2liaWxpdHk6IGJvb2xlYW4pID0+IHRoaXMudmlld2VyQ2hhbmdlLmVtaXQodmlzaWJpbGl0eSkpXG4gICAgfVxuXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xuICAgICAgICAvLyBpbnB1dCBwYXJhbXMgY2hhbmdlZFxuICAgICAgICBpZiAoY2hhbmdlc1sncHJvdmlkZWRHYWxsZXJ5TmFtZSddICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5mZXRjaERhdGFBbmRSZW5kZXIoKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5yZW5kZXIoKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLnZpZXdlclN1YnNjcmlwdGlvbikge1xuICAgICAgICAgICAgdGhpcy52aWV3ZXJTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgb3BlbkltYWdlVmlld2VyKGltZzogYW55KTogdm9pZCB7XG4gICAgICAgIHRoaXMuaW1hZ2VTZXJ2aWNlLnVwZGF0ZUltYWdlcyh0aGlzLmltYWdlcylcbiAgICAgICAgdGhpcy5pbWFnZVNlcnZpY2UudXBkYXRlU2VsZWN0ZWRJbWFnZUluZGV4KHRoaXMuaW1hZ2VzLmluZGV4T2YoaW1nKSlcbiAgICAgICAgdGhpcy5pbWFnZVNlcnZpY2Uuc2hvd0ltYWdlVmlld2VyKHRydWUpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogZGlyZWN0aW9uICgtMTogbGVmdCwgMTogcmlnaHQpXG4gICAgICovXG4gICAgbmF2aWdhdGUoZGlyZWN0aW9uOiBudW1iZXIpOiB2b2lkIHtcbiAgICAgICAgaWYgKChkaXJlY3Rpb24gPT09IDEgJiYgdGhpcy5yb3dJbmRleCA8IHRoaXMuZ2FsbGVyeS5sZW5ndGggLSB0aGlzLnJvd3NQZXJQYWdlKVxuICAgICAgICAgICAgfHwgKGRpcmVjdGlvbiA9PT0gLTEgJiYgdGhpcy5yb3dJbmRleCA+IDApKSB7XG4gICAgICAgICAgICB0aGlzLnJvd0luZGV4ICs9ICh0aGlzLnJvd3NQZXJQYWdlICogZGlyZWN0aW9uKVxuICAgICAgICB9XG4gICAgICAgIHRoaXMucmVmcmVzaE5hdmlnYXRpb25FcnJvclN0YXRlKClcbiAgICB9XG5cbiAgICBjYWxjSW1hZ2VNYXJnaW4oKTogbnVtYmVyIHtcbiAgICAgICAgY29uc3QgZ2FsbGVyeVdpZHRoID0gdGhpcy5nZXRHYWxsZXJ5V2lkdGgoKVxuICAgICAgICBjb25zdCByYXRpbyA9IGdhbGxlcnlXaWR0aCAvIDE5MjBcbiAgICAgICAgcmV0dXJuIE1hdGgucm91bmQoTWF0aC5tYXgoMSwgdGhpcy5wcm92aWRlZEltYWdlTWFyZ2luICogcmF0aW8pKVxuICAgIH1cblxuICAgIHByaXZhdGUgZmV0Y2hEYXRhQW5kUmVuZGVyKCk6IHZvaWQge1xuICAgICAgICB0aGlzLmltYWdlRGF0YUNvbXBsZXRlUGF0aCA9IHRoaXMucHJvdmlkZWRNZXRhZGF0YVVyaVxuXG4gICAgICAgIGlmICghdGhpcy5wcm92aWRlZE1ldGFkYXRhVXJpKSB7XG4gICAgICAgICAgICB0aGlzLmltYWdlRGF0YUNvbXBsZXRlUGF0aCA9IHRoaXMucHJvdmlkZWRHYWxsZXJ5TmFtZSAhPT0gJycgP1xuICAgICAgICAgICAgICAgIGAke3RoaXMuaW1hZ2VEYXRhU3RhdGljUGF0aCArIHRoaXMucHJvdmlkZWRHYWxsZXJ5TmFtZX0vJHt0aGlzLmRhdGFGaWxlTmFtZX1gIDpcbiAgICAgICAgICAgICAgICB0aGlzLmltYWdlRGF0YVN0YXRpY1BhdGggKyB0aGlzLmRhdGFGaWxlTmFtZVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5odHRwLmdldCh0aGlzLmltYWdlRGF0YUNvbXBsZXRlUGF0aClcbiAgICAgICAgICAuc3Vic2NyaWJlKFxuICAgICAgICAgICAgKGRhdGE6IEFycmF5PGFueT4pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbWFnZXMgPSBkYXRhXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW1hZ2VTZXJ2aWNlLnVwZGF0ZUltYWdlcyh0aGlzLmltYWdlcylcblxuICAgICAgICAgICAgICAgICAgICB0aGlzLmltYWdlcy5mb3JFYWNoKGltYWdlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICBpbWFnZVsnZ2FsbGVyeUltYWdlTG9hZGVkJ10gPSBmYWxzZVxuICAgICAgICAgICAgICAgICAgICAgIGltYWdlWyd2aWV3ZXJJbWFnZUxvYWRlZCddID0gZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgICBpbWFnZVsnc3JjQWZ0ZXJGb2N1cyddID0gJydcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLy8gdHdpY2UsIHNpbmdsZSBsZWFkcyB0byBkaWZmZXJlbnQgc3RyYW5nZSBicm93c2VyIGJlaGF2aW91clxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcigpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyKClcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBlcnIgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5wcm92aWRlZE1ldGFkYXRhVXJpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgUHJvdmlkZWQgZW5kcG9pbnQgJyR7dGhpcy5wcm92aWRlZE1ldGFkYXRhVXJpfScgZGlkIG5vdCBzZXJ2ZSBtZXRhZGF0YSBjb3JyZWN0bHkgb3IgaW4gdGhlIGV4cGVjdGVkIGZvcm1hdC5cbiAgICAgIFNlZSBoZXJlIGZvciBtb3JlIGluZm9ybWF0aW9uOiBodHRwczovL2dpdGh1Yi5jb20vQmVuamFtaW5CcmFuZG1laWVyL2FuZ3VsYXIyLWltYWdlLWdhbGxlcnkvYmxvYi9tYXN0ZXIvZG9jcy9leHRlcm5hbERhdGFTb3VyY2UubWQsXG4gICAgICBPcmlnaW5hbCBlcnJvcjogJHtlcnJ9YClcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYERpZCB5b3UgcnVuIHRoZSBjb252ZXJ0IHNjcmlwdCBmcm9tIGFuZ3VsYXIyLWltYWdlLWdhbGxlcnkgZm9yIHlvdXIgaW1hZ2VzIGZpcnN0PyBPcmlnaW5hbCBlcnJvcjogJHtlcnJ9YClcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgKCkgPT4gdW5kZWZpbmVkKVxuICAgIH1cblxuICAgIHByaXZhdGUgcmVuZGVyKCk6IHZvaWQge1xuICAgICAgICB0aGlzLmdhbGxlcnkgPSBbXVxuXG4gICAgICAgIGxldCB0ZW1wUm93ID0gW3RoaXMuaW1hZ2VzWzBdXVxuICAgICAgICBsZXQgY3VycmVudFJvd0luZGV4ID0gMFxuICAgICAgICBsZXQgaSA9IDBcblxuICAgICAgICBmb3IgKGk7IGkgPCB0aGlzLmltYWdlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgd2hpbGUgKHRoaXMuaW1hZ2VzW2kgKyAxXSAmJiB0aGlzLnNob3VsZEFkZENhbmRpZGF0ZSh0ZW1wUm93LCB0aGlzLmltYWdlc1tpICsgMV0pKSB7XG4gICAgICAgICAgICAgICAgaSsrXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5pbWFnZXNbaSArIDFdKSB7XG4gICAgICAgICAgICAgICAgdGVtcFJvdy5wb3AoKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5nYWxsZXJ5W2N1cnJlbnRSb3dJbmRleCsrXSA9IHRlbXBSb3dcblxuICAgICAgICAgICAgdGVtcFJvdyA9IFt0aGlzLmltYWdlc1tpICsgMV1dXG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnNjYWxlR2FsbGVyeSgpXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzaG91bGRBZGRDYW5kaWRhdGUoaW1nUm93OiBBcnJheTxhbnk+LCBjYW5kaWRhdGU6IGFueSk6IGJvb2xlYW4ge1xuICAgICAgICBjb25zdCBvbGREaWZmZXJlbmNlID0gdGhpcy5jYWxjSWRlYWxIZWlnaHQoKSAtIHRoaXMuY2FsY1Jvd0hlaWdodChpbWdSb3cpXG4gICAgICAgIGltZ1Jvdy5wdXNoKGNhbmRpZGF0ZSlcbiAgICAgICAgY29uc3QgbmV3RGlmZmVyZW5jZSA9IHRoaXMuY2FsY0lkZWFsSGVpZ2h0KCkgLSB0aGlzLmNhbGNSb3dIZWlnaHQoaW1nUm93KVxuXG4gICAgICAgIHJldHVybiBNYXRoLmFicyhvbGREaWZmZXJlbmNlKSA+IE1hdGguYWJzKG5ld0RpZmZlcmVuY2UpXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjYWxjUm93SGVpZ2h0KGltZ1JvdzogQXJyYXk8YW55Pik6IG51bWJlciB7XG4gICAgICAgIGNvbnN0IG9yaWdpbmFsUm93V2lkdGggPSB0aGlzLmNhbGNPcmlnaW5hbFJvd1dpZHRoKGltZ1JvdylcblxuICAgICAgICBjb25zdCByYXRpbyA9ICh0aGlzLmdldEdhbGxlcnlXaWR0aCgpIC0gKGltZ1Jvdy5sZW5ndGggLSAxKSAqIHRoaXMuY2FsY0ltYWdlTWFyZ2luKCkpIC8gb3JpZ2luYWxSb3dXaWR0aFxuICAgICAgICBjb25zdCByb3dIZWlnaHQgPSBpbWdSb3dbMF1bdGhpcy5taW5pbWFsUXVhbGl0eUNhdGVnb3J5XVsnaGVpZ2h0J10gKiByYXRpb1xuXG4gICAgICAgIHJldHVybiByb3dIZWlnaHRcbiAgICB9XG5cbiAgICBwcml2YXRlIGNhbGNPcmlnaW5hbFJvd1dpZHRoKGltZ1JvdzogQXJyYXk8YW55Pik6IG51bWJlciB7XG4gICAgICAgIGxldCBvcmlnaW5hbFJvd1dpZHRoID0gMFxuICAgICAgICBpbWdSb3cuZm9yRWFjaChpbWcgPT4ge1xuICAgICAgICAgICAgY29uc3QgaW5kaXZpZHVhbFJhdGlvID0gdGhpcy5jYWxjSWRlYWxIZWlnaHQoKSAvIGltZ1t0aGlzLm1pbmltYWxRdWFsaXR5Q2F0ZWdvcnldWydoZWlnaHQnXVxuICAgICAgICAgICAgaW1nW3RoaXMubWluaW1hbFF1YWxpdHlDYXRlZ29yeV1bJ3dpZHRoJ10gPSBpbWdbdGhpcy5taW5pbWFsUXVhbGl0eUNhdGVnb3J5XVsnd2lkdGgnXSAqIGluZGl2aWR1YWxSYXRpb1xuICAgICAgICAgICAgaW1nW3RoaXMubWluaW1hbFF1YWxpdHlDYXRlZ29yeV1bJ2hlaWdodCddID0gdGhpcy5jYWxjSWRlYWxIZWlnaHQoKVxuICAgICAgICAgICAgb3JpZ2luYWxSb3dXaWR0aCArPSBpbWdbdGhpcy5taW5pbWFsUXVhbGl0eUNhdGVnb3J5XVsnd2lkdGgnXVxuICAgICAgICB9KVxuXG4gICAgICAgIHJldHVybiBvcmlnaW5hbFJvd1dpZHRoXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjYWxjSWRlYWxIZWlnaHQoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0R2FsbGVyeVdpZHRoKCkgLyAoODAgLyB0aGlzLnByb3ZpZGVkSW1hZ2VTaXplKSArIDEwMFxuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0R2FsbGVyeVdpZHRoKCk6IG51bWJlciB7XG4gICAgICAgIGlmICh0aGlzLmdhbGxlcnlDb250YWluZXIubmF0aXZlRWxlbWVudC5jbGllbnRXaWR0aCA9PT0gMCkge1xuICAgICAgICAgICAgLy8gZm9yIElFMTFcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdhbGxlcnlDb250YWluZXIubmF0aXZlRWxlbWVudC5zY3JvbGxXaWR0aFxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLmdhbGxlcnlDb250YWluZXIubmF0aXZlRWxlbWVudC5jbGllbnRXaWR0aFxuICAgIH1cblxuICAgIHByaXZhdGUgc2NhbGVHYWxsZXJ5KCk6IHZvaWQge1xuICAgICAgICBsZXQgaW1hZ2VDb3VudGVyID0gMFxuICAgICAgICBsZXQgbWF4aW11bUdhbGxlcnlJbWFnZUhlaWdodCA9IDBcblxuICAgICAgICB0aGlzLmdhbGxlcnkuc2xpY2UodGhpcy5yb3dJbmRleCwgdGhpcy5yb3dJbmRleCArIHRoaXMucm93c1BlclBhZ2UpXG4gICAgICAgICAgLmZvckVhY2goaW1nUm93ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsUm93V2lkdGggPSB0aGlzLmNhbGNPcmlnaW5hbFJvd1dpZHRoKGltZ1JvdylcblxuICAgICAgICAgICAgaWYgKGltZ1JvdyAhPT0gdGhpcy5nYWxsZXJ5W3RoaXMuZ2FsbGVyeS5sZW5ndGggLSAxXSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJhdGlvID0gKHRoaXMuZ2V0R2FsbGVyeVdpZHRoKCkgLSAoaW1nUm93Lmxlbmd0aCAtIDEpICogdGhpcy5jYWxjSW1hZ2VNYXJnaW4oKSkgLyBvcmlnaW5hbFJvd1dpZHRoXG5cbiAgICAgICAgICAgICAgICBpbWdSb3cuZm9yRWFjaCgoaW1nOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaW1nWyd3aWR0aCddID0gaW1nW3RoaXMubWluaW1hbFF1YWxpdHlDYXRlZ29yeV1bJ3dpZHRoJ10gKiByYXRpb1xuICAgICAgICAgICAgICAgICAgICBpbWdbJ2hlaWdodCddID0gaW1nW3RoaXMubWluaW1hbFF1YWxpdHlDYXRlZ29yeV1bJ2hlaWdodCddICogcmF0aW9cbiAgICAgICAgICAgICAgICAgICAgbWF4aW11bUdhbGxlcnlJbWFnZUhlaWdodCA9IE1hdGgubWF4KG1heGltdW1HYWxsZXJ5SW1hZ2VIZWlnaHQsIGltZ1snaGVpZ2h0J10pXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tGb3JBc3luY0xvYWRpbmcoaW1nLCBpbWFnZUNvdW50ZXIrKylcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpbWdSb3cuZm9yRWFjaCgoaW1nOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaW1nLndpZHRoID0gaW1nW3RoaXMubWluaW1hbFF1YWxpdHlDYXRlZ29yeV1bJ3dpZHRoJ11cbiAgICAgICAgICAgICAgICAgICAgaW1nLmhlaWdodCA9IGltZ1t0aGlzLm1pbmltYWxRdWFsaXR5Q2F0ZWdvcnldWydoZWlnaHQnXVxuICAgICAgICAgICAgICAgICAgICBtYXhpbXVtR2FsbGVyeUltYWdlSGVpZ2h0ID0gTWF0aC5tYXgobWF4aW11bUdhbGxlcnlJbWFnZUhlaWdodCwgaW1nWydoZWlnaHQnXSlcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGVja0ZvckFzeW5jTG9hZGluZyhpbWcsIGltYWdlQ291bnRlcisrKVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG5cbiAgICAgICAgdGhpcy5taW5pbWFsUXVhbGl0eUNhdGVnb3J5ID0gbWF4aW11bUdhbGxlcnlJbWFnZUhlaWdodCA+IDM3NSA/ICdwcmV2aWV3X3hzJyA6ICdwcmV2aWV3X3h4cydcbiAgICAgICAgdGhpcy5yZWZyZXNoTmF2aWdhdGlvbkVycm9yU3RhdGUoKVxuXG4gICAgICAgIHRoaXMuY2hhbmdlRGV0ZWN0b3JSZWYuZGV0ZWN0Q2hhbmdlcygpXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjaGVja0ZvckFzeW5jTG9hZGluZyhpbWFnZTogYW55LCBpbWFnZUNvdW50ZXI6IG51bWJlcik6IHZvaWQge1xuICAgICAgICBjb25zdCBpbWFnZUVsZW1lbnRzID0gdGhpcy5pbWFnZUVsZW1lbnRzLnRvQXJyYXkoKVxuXG4gICAgICAgIGlmIChpbWFnZVsnZ2FsbGVyeUltYWdlTG9hZGVkJ10gfHxcbiAgICAgICAgICAgIChpbWFnZUVsZW1lbnRzLmxlbmd0aCA+IDAgJiZcbiAgICAgICAgICAgICAgaW1hZ2VFbGVtZW50c1tpbWFnZUNvdW50ZXJdICYmXG4gICAgICAgICAgICAgIHRoaXMuaXNTY3JvbGxlZEludG9WaWV3KGltYWdlRWxlbWVudHNbaW1hZ2VDb3VudGVyXS5uYXRpdmVFbGVtZW50KSkpIHtcbiAgICAgICAgICAgIGltYWdlWydnYWxsZXJ5SW1hZ2VMb2FkZWQnXSA9IHRydWVcbiAgICAgICAgICAgIGltYWdlWydzcmNBZnRlckZvY3VzJ10gPSBpbWFnZVt0aGlzLm1pbmltYWxRdWFsaXR5Q2F0ZWdvcnldWydwYXRoJ11cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGltYWdlWydzcmNBZnRlckZvY3VzJ10gPSAnJ1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpc1Njcm9sbGVkSW50b1ZpZXcoZWxlbWVudDogYW55KTogYm9vbGVhbiB7XG4gICAgICAgIGNvbnN0IGVsZW1lbnRUb3AgPSBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcFxuICAgICAgICBjb25zdCBlbGVtZW50Qm90dG9tID0gZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5ib3R0b21cblxuICAgICAgICByZXR1cm4gZWxlbWVudFRvcCA8IHdpbmRvdy5pbm5lckhlaWdodCAmJiBlbGVtZW50Qm90dG9tID49IDAgJiYgKGVsZW1lbnRCb3R0b20gPiAwIHx8IGVsZW1lbnRUb3AgPiAwKVxuICAgIH1cblxuICAgIHByaXZhdGUgcmVmcmVzaE5hdmlnYXRpb25FcnJvclN0YXRlKCk6IHZvaWQge1xuICAgICAgICB0aGlzLmxlZnRBcnJvd0luYWN0aXZlID0gdGhpcy5yb3dJbmRleCA9PSAwXG4gICAgICAgIHRoaXMucmlnaHRBcnJvd0luYWN0aXZlID0gdGhpcy5yb3dJbmRleCA+ICh0aGlzLmdhbGxlcnkubGVuZ3RoIC0gdGhpcy5yb3dzUGVyUGFnZSlcbiAgICB9XG59XG4iXX0=